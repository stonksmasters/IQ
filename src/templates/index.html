<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Signal Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/css/styles.css">

  <style>
    /* Base styling */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f4f4f9;
      color: #333;
    }

    h1, h2 {
      margin: 0;
      padding: 0;
      color: #007bff;
    }

    /* Container Layout */
    .container {
      display: flex;
      flex-direction: row;
      height: 100vh;
      overflow: hidden;
    }

    .signal-section {
      width: 30%;
      min-width: 300px;
      max-width: 400px;
      background: #fff;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #ddd;
    }

    .signal-header {
      padding: 15px;
      text-align: center;
      background-color: #f8f9fa;
      border-bottom: 1px solid #ddd;
    }

    .signal-lists {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
    }

    .signal-lists h2 {
      margin: 20px 0 10px;
      font-size: 1.2rem;
    }

    ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f8f9fa;
      margin-bottom: 10px;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }

    li:hover {
      transform: scale(1.02);
    }

    .track-button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 5px 15px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .track-button:hover {
      background-color: #0056b3;
    }

    .clear-button {
      display: inline-block;
      margin-top: 10px;
      background-color: #dc3545;
      color: #fff;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .clear-button:hover {
      background-color: #b02a37;
    }

    .video-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 15px;
    }

    .video-title {
      margin-bottom: 15px;
      text-align: center;
    }

    .video-container {
      width: 100%;
      height: calc(100% - 60px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .signal-section {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #ddd;
        height: 40vh;
      }

      .video-section {
        height: 60vh;
      }

      .video-container {
        height: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Left Side: Signal Section -->
    <div class="signal-section">
      <div class="signal-header">
        <h1>Signal Tracker</h1>
      </div>
      <div class="signal-lists">
        <h2>Wi-Fi Signals</h2>
        <ul id="wifi-list"></ul>

        <h2>Bluetooth Signals</h2>
        <ul id="bluetooth-list"></ul>

        <button class="clear-button" onclick="clearSignal()">Clear Tracking</button>
      </div>
    </div>

    <!-- Right Side: Video Feed -->
    <div class="video-section">
      <h2 class="video-title">Live Video Feed</h2>
      <div class="video-container">
        <img
          src="/video_feed"
          alt="Live Video Feed"
          style="width: 100%; height: 100%; object-fit: cover;"
        />
      </div>
    </div>
  </div>

  <script>
    // Fetch signals and update the signal lists
    async function fetchSignals() {
      try {
        const response = await fetch('/signals');
        const data = await response.json();

        const wifiList = document.getElementById('wifi-list');
        const bluetoothList = document.getElementById('bluetooth-list');

        wifiList.innerHTML = '';
        bluetoothList.innerHTML = '';

        data.signals.forEach(signal => {
          const listItem = document.createElement('li');
          const signalName = signal.name || signal.SSID || "Unknown";
          const signalStrength = signal.rssi || signal.signal || "N/A";
          const type = signal.type || "Unknown";

          listItem.innerHTML = `
            <div class="signal-info">
              <strong>${signalName}</strong> (${signalStrength} dBm)
            </div>
          `;
          const button = document.createElement('button');
          button.textContent = 'Track';
          button.className = 'track-button';
          button.onclick = () => trackSignal(type, signalName);

          listItem.appendChild(button);
          if (type === "wifi") {
            wifiList.appendChild(listItem);
          } else if (type === "bluetooth") {
            bluetoothList.appendChild(listItem);
          }
        });
      } catch (error) {
        console.error("Error fetching signals:", error);
      }
    }

    // Track a signal
    async function trackSignal(type, name) {
      try {
        await fetch('/track_signal', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ type, name })
        });
        alert(`Now tracking ${type.toUpperCase()} signal: ${name}`);
      } catch (error) {
        console.error("Error tracking signal:", error);
      }
    }

    // Clear tracked signals
    async function clearSignal() {
      try {
        await fetch('/clear_signal', { method: 'POST' });
        alert('Tracking cleared.');
      } catch (error) {
        console.error("Error clearing signal:", error);
      }
    }

    // Refresh signals every 5 seconds
    setInterval(fetchSignals, 5000);

    // Initialize signals on load
    window.onload = fetchSignals;
  </script>
</body>
</html>
